-- Roblox Desync Script with Server Rejoin
-- Client-sided script for Roblox executors

local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Whitelist
local WHITELISTED_IDS = {
    [9390115208] = true,
    [5421164903] = true
}

-- Function to send notification
local function sendNotification(title, text, duration)
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = title,
        Text = text,
        Duration = duration or 3
    })
end

-- Check if player is whitelisted
if not WHITELISTED_IDS[LocalPlayer.UserId] then
    LocalPlayer:Kick('"No skidding allowed" -svxft')
    return
end

-- Whitelist notification
sendNotification("Whitelist", "Whitelist found, access granted", 3)

-- Wait a moment for the notification to display
wait(1)

-- Set the FFlag
pcall(function()
    setfflag("NextGenReplicatorEnabledWrite4", "true")
end)

-- Send notification
sendNotification("Desync", "Applying desync!", 3)

-- Wait a moment for the notification to display
wait(1)

-- Get current server's JobId
local jobId = game.JobId

-- Check if we're in a public server (has a JobId)
if jobId and jobId ~= "" then
    -- Rejoin the same server
    TeleportService:TeleportToPlaceInstance(game.PlaceId, jobId, LocalPlayer)
else
    -- If no JobId (like in a reserved server), just rejoin normally
    TeleportService:Teleport(game.PlaceId, LocalPlayer)
end
